'use client'

import Link from "next/link";
import DetailButton from "./DetailButton";
import axios from "axios";
import { useRouter } from "next/navigation";


export default function ListItem({ post }) {

  const router = useRouter();

  return (
    <div className="list-item">
      {/* í˜ì´ì§€ë¥¼ ì´ë™í•˜ëŠ” ë°©ë²•(1) - Link ì»´í¬ë„ŒíŠ¸ */}
      {/* Link ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ '/detail/ê¸€id'ë¡œ ì´ë™ */}
      <h4>
        {/* ë¬¸ìì—´ê³¼ ê²°í•©í•˜ë©´ Objectê°€ ë¬¸ìì—´ë¡œ ë³€í•¨. ë•Œë¬¸ì— _id.toString() ìƒëµ */}
        <Link href={`/detail/${post._id}`}>
          {post.title}
        </Link>
      </h4>

      {/* í˜ì´ì§€ë¥¼ ì´ë™í•˜ëŠ” ë°©ë²•(2) - useRouter */}
      <DetailButton postId={post._id.toString()} />

      {/* ìˆ˜ì • ë²„íŠ¼ */}
      <Link href={`/edit/${post._id}`}>ğŸ› </Link>

      {/* ì‚­ì œ ë²„íŠ¼ */}
      <span className="cursor-pointer" onClick={async (e) => {
        // ì²«ë²ˆì§¸ ë°©ë²•, query string. http~ ì“°ë©´ ì•ˆë¨
        // await axios.delete(`/api/post?postId=${post._id}`);

        // ë‘ë²ˆì§¸ ë°©ë²• URL íŒŒë¼ë¯¸í„°
        await axios.delete(`/api/post/${post._id}`);

        // e.target.parentElement.remove();  // ìš”ì†Œ ì œê±°
        // location.href = '/list';  // ë‹¤ì‹œ listë¡œ ì´ë™, ìƒˆë¡œê³ ì¹¨ ë°œìƒ
        router.refresh(); // soft refresh. ë³€ë™ì´ ìˆëŠ” ì¼ë¶€ë¶„ë§Œ ë°”ê¿”ì¤Œ

      }}>ğŸ”ª</span>

      <p>{post.content}</p>
    </div>
  );
};

// ìƒì„¸ í˜ì´ì§€ ë§Œë“¤ê¸°
// 1) ê¸€ ì œëª© ëˆ„ë¥´ë©´ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
// 2) DBì—ì„œ í•´ë‹¹ ê²Œì‹œê¸€ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì£¼ê¸°
// => ì´ë•Œ ìƒì„¸ í˜ì´ì§€ URLì€? ì§€ê¸ˆê¹Œì§€ì˜ ë°©ì‹: /detail/ê¸€ì˜ ì•„ì´ë””
// => /app/detail í´ë” ì•ˆì— ì—¬ëŸ¬ í´ë” ë§Œë“¤ë©´ ë¹„íš¨ìœ¨ì 
// => React: URL íŒŒë¼ë¯¸í„°, Express: ë¼ìš°íŠ¸ íŒŒë¼ë¯¸í„° (ë‘˜ ë‹¤ ê°™ìŒ)
// => Next.js: Dynamic Routes ì‚¬ìš© -> íŒŒì¼ ë˜ëŠ” í´ë” ì´ë¦„ì„ ëŒ€ê´„í˜¸ë¡œ ë¬¶ì–´ ìƒì„± []
// ê·¸ ì™¸
// \[ë³€ìˆ˜ëª…1]\[ë³€ìˆ˜ëª…2]\[ë³€ìˆ˜ëª…3]
// [...ë³€ìˆ˜ëª…]: Catch-all
// [[...ë³€ìˆ˜ëª…]]:Optional Catch-all

// ê¸€ ìˆ˜ì • ê¸°ëŠ¥ ë§Œë“¤ê¸°
// 1) ìˆ˜ì • ë²„íŠ¼ ëˆ„ë¥´ë©´ ê¸€ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
// 2) ê¸€ ìˆ˜ì • í˜ì´ì§€ì— DBì—ì„œ ê°€ì ¸ì˜¨ ë‚´ìš©ì„ ì±„ì›Œë„£ê¸°
// 3) ìˆ˜ì • ë²„íŠ¼ ëˆ„ë¥´ë©´ DBì— ìˆëŠ” ê¸€ ìˆ˜ì •

// ê¸€ ì‚­ì œ ê¸°ëŠ¥ ë§Œë“¤ê¸°
// í”„ë¡ íŠ¸ë‹¨ JS ê¸°ëŠ¥ì„ ì“°ë ¤ë©´ client ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ê°€ëŠ¥
// /list/page.js íŒŒì¼ì„ ì „ë¶€ clientì»´í¬ë„ŒíŠ¸ë¡œ ë°”ê¾¸ëŠ” ê²ƒë³´ë‹¤ í•„ìš”í•œ ì¼ë¶€ë¶„ë§Œ ë°”ê¾¸ëŠ”ê²Œ ë‚˜ìŒ
// => ì „ì²´ë¥¼ ë°”ê¿”ë²„ë¦¬ë©´ ê²€ìƒ‰ ë…¸ì¶œì— ì´ì ì´ ì—†ìŒ
// ì¦‰, í° í˜ì´ì§€ëŠ” server ì»´í¬ë„ŒíŠ¸ë¡œ ë‘ê³  í•„ìš”í•œ ë¶€ë¶„ë§Œ client ì»´í¬ë„ŒíŠ¸ë¡œ ì¶”ì¶œ

// 1) /list/ListItem.jsë¡œ ì»´í¬ë„ŒíŠ¸ ì¶”ì¶œ
// 2) ê¸€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” 2ê°€ì§€ ë°©ë²•
// - ë¶€ëª¨(server ì»´í¬ë„ŒíŠ¸)ì—ì„œ DBë°ì´í„°ë¥¼ êº¼ë‚´ì™€ì„œ ìì‹(client ì»´í¬ë„ŒíŠ¸)ì—ê²Œ propsë¡œ ì „ë‹¬(ê¶Œì¥ë¨)
// - client ì»´í¬ë„ŒíŠ¸ì—ì„œ useEffect + axiosë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¡œ DBë°ì´í„° ìš”ì²­
//    -> ë‹¨ì : ê²€ìƒ‰ ë…¸ì¶œì´ ì˜ ì•ˆë  ìˆ˜ ìˆìŒ
//    - useEffectë¥¼ ì“°ë©´ HTML ë Œë”ë§ ì´í›„ì— ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— í˜ì´ì§€ ë°©ë¬¸ ì‹œ í…… ë¹ˆ HTMLì´ ë¨¼ì € ë³´ì„
//    - ê²€ìƒ‰ì—”ì§„ ë´‡ì´ ë°©ë¬¸ ì‹œ ìˆ˜ì§‘í•  ë°ì´í„°ê°€ ì—†ì–´ ìˆ˜ì§‘ì´ ëŠë¦¼

// [Quiz]
// ê¸€ ì‚­ì œ ê¸°ëŠ¥ ì™„ì„±í•˜ê¸°(2ê°€ì§€ ë°©ë²•)
// 1) /api/post?postId=ê¸€idë¡œ DELETE ìš”ì²­ ì‹œ
// 2) /api/post/ê¸€idë¡œ DELETE ìš”ì²­ ì‹œ